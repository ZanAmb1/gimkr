// Seznam prostosti učilnic GimKr
// Podatki zajeti 2019-08-30
// Nazadnje posodobljeno 2018-10-28
/* Avtor: Žan Žnidar */

var container = {};

container["p"] = [[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]]];

container["p1"] = [[["8","26","47"],["8","26"],["7","22","23","26","42"],["7","11","12","14","16","22","23","26","27","28","42","44","47","49"],["1","5","6","9","12","14","15","23","25","26","29","42","43","44","49","sptel","vp","zgtel"],["1","8","9","23","26","29","48"],["7","8","26","42"],["7","8","12","26","46","48"],["1","3","4","5","6","7","8","12","13","14","15","16","17","22","23","24","25","26","27","28","29","30","31","42","43","44","45","46","47","48","49"],["1","3","4","5","6","7","8","12","13","14","15","16","17","22","23","24","25","26","27","28","29","30","31","42","43","44","45","46","47","48","49","sptel","vp","zgtel"]],[["1","3","6","7","13","26","30"],["1","6","8","12","26","31","42"],["5","26","28","29","42"],["1","2","3","5","6","7","9","11","12","14","15","16","17","22","23","24","26","29","30","42","47","49"],["3","4","5","8","9","13","14","17","22","26","28","29","30","31","43","45","46"],["5","7","8","13","14","26","27"],["1","7","8","9","16","26","28"],["1","3","5","6","7","8","9","11","12","13","15","16","17","21","22","23","24","25","26","27","28","29","30","31","42","43","44","45","46","47","48","49","sptel","vp","zgtel"],["3","4","5","6","7","8","9","11","12","13","15","16","17","21","22","23","24","25","26","27","28","29","30","31","42","43","44","45","46","47","48","49","sptel","vp","zgtel"],["1","3","5","6","7","8","9","11","12","13","15","16","17","21","22","23","24","25","26","27","28","29","30","31","42","43","44","45","46","47","48","49","sptel","vp","zgtel"]],[["14","26","sptel","vp","zgtel"],["14","23","26"],["4","5","7","8","26","27","48"],["4","5","6","9","11","14","16","22","26","29","30","31","42","46","47","49"],["3","5","6","9","11","12","15","16","17","22","23","25","26","28","29","30","42","43","44","45","47"],["16","26","30","42","47"],["4","16","26","30","47","vp"],["2","4","5","11","13","14","15","16","22","23","25","26","27","28","29","30","31","42","44","46","47","48","49","sptel","vp","zgtel"],["1","4","5","11","13","15","16","21","22","23","25","26","27","28","29","30","31","42","44","46","47","48","49","sptel","vp","zgtel"],["1","3","4","5","6","7","8","9","11","12","13","15","16","17","21","22","23","24","25","26","27","28","29","30","31","42","43","44","45","46","47","48","49","sptel","vp","zgtel"]],[["3","7","8","24","26","30","46"],["7","8","23","24","26"],["1","5","7","8","17","26","48"],["1","5","7","8","9","14","15","16","17","25","26","28","29","31","43","44","46","47","48","49","vp"],["8","9","11","14","17","23","24","26","28","29","30","42","43","46","47","49"],["1","7","9","11","26"],["8","26"],["1","3","12","17","23","26","29","43","45","49"],["1","3","4","5","6","8","9","11","12","13","15","16","17","22","23","24","25","26","27","29","30","31","42","43","44","45","46","47","48","49"],["2","3","4","5","6","8","9","11","12","13","14","15","16","17","22","23","24","25","26","27","28","29","30","31","42","43","44","45","46","47","48","49","sptel","vp","zgtel"]],[["1","3","7","8","9","11","13","15","24","26","42","43","44","46"],["6","8","9","11","14","16","26"],["6","9","16","26"],["5","6","11","13","15","23","25","26","30","31","42","46"],["3","4","5","6","7","8","9","11","13","16","17","21","22","25","26","27","28","29","30","31","42","44","45","46","47"],["4","5","7","13","26","28"],["4","7","26","31","sptel","vp","zgtel"],["1","3","4","5","6","9","11","13","16","17","22","23","24","25","26","42","43","44","45","46","47","48","49","sptel","vp","zgtel"],["1","3","4","5","6","7","8","9","11","12","13","15","16","17","21","22","23","24","25","26","28","29","31","42","43","44","45","46","47","48","49","sptel","vp","zgtel"],["1","2","3","4","5","6","7","8","9","11","12","13","14","15","16","17","21","22","23","24","25","26","27","28","29","31","42","43","44","45","46","47","48","49","sptel","vp","zgtel"]]];

container["p2"] = [[["Ni podatkov."],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]]];

container["p3"] = [[["Ni podatkov."],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]]];

container["p4"] = [[["Ni podatkov."],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]]];

//container["prazen"] = [[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]]];

var tedni = [[[1567375200000,1567807140000],[1569794400000,1570226340000],[1572822000000,1573253940000],[1575241200000,1575673140000],[1578870000000,1579301940000],[1581289200000,1581807540000],[1584313200000,1584745140000],[1586728800000,1587160740000],[1589752800000,1590184740000],[1592776800000,1592949540000]],[[1567980000000,1568411940000],[1570399200000,1570831140000],[1573426800000,1573858740000],[1575846000000,1576277940000],[1579474800000,1579906740000],[1582498800000,1582930740000],[1584918000000,1585349940000],[1587333600000,1587765540000],[1590357600000,1590789540000]],[[1568584800000,1569016740000],[1571004000000,1571435940000],[1574031600000,1574463540000],[1576450800000,1576882740000],[1580079600000,1580511540000],[1583103600000,1583535540000],[1585519200000,1585951140000],[1588543200000,1588975140000],[1590962400000,1591394340000]],[[1569189600000,1569621540000],[1571608800000,1572040740000],[1574636400000,1575068340000],[1577055600000,1577228340000],[1578265200000,1578697140000],[1580684400000,1581116340000],[1583708400000,1584140340000],[1586124000000,1586555940000],[1589148000000,1589579940000],[1591567200000,1591999140000]]];

prikaz(stUrnika());
obarvaj();


function stUrnika() {	
    for (var u = 0; u < tedni.length; u++) {
        for (var t = 0; t < tedni[u].length; t++) {
            if (tedni[u][t][0] <= Date.now() && tedni[u][t][1] >= Date.now()) {
				document.getElementById("urnik").innerHTML = "Trenutni urnik: <b>" + (u+1) + "</b>";
                return (u+1);
            } else if(tedni[u][t][0] <= (Date.now() + 172800000) && tedni[u][t][1] >= (Date.now() + 172800000)) {
				document.getElementById("urnik").innerHTML = "Prihajajoči urnik: <b>" + (u+1) + "</b>";
                return (u+1);
			}
        }
    }
	document.getElementById("urnik").innerHTML = "Počitnice <b>:)</b>";
	return ("");
}


function prikaz(a) {
    var zbirka = container["p" + a];
    //console.log(zbirka);

    var tabela = document.getElementById("tbl");

    for (var s = 0; s < zbirka.length; s++) {

        for (var v = 0; v < zbirka[s].length; v++) {
            //console.log(zbirka[s][v]);
            vrste = tabela.getElementsByTagName("tr");
            var stolpci = vrste[v + 1].getElementsByTagName("td");
            stolpci[s + 1].innerText = zbirka[s][v];
            stolpci[s + 1].innerText = stolpci[s + 1].innerText.replace(/,/g, ", ");

        }
    }
    vrste[0].getElementsByTagName("td")[0].innerText = "Urnik " + a;

}

function obarvaj() {
   var d = new Date();

	for(var i = 1; i < vrste.length; i++) {
		var casovi = (vrste[i].getElementsByTagName("td")[0].innerText.split("\n")[1].split("(")[1].split(")")[0]);
		var us = casovi.split("–")[0].split(".")[0]; // ura start
		var ms = casovi.split("–")[0].split(".")[1]; // min start
		var ue = casovi.split("–")[1].split(".")[0]; // ura end
		var me = casovi.split("–")[1].split(".")[1]; // min end
		
		d.setHours(us);
		var cs = d.setMinutes(ms); // cas start
		
		d.setHours(ue);
		var ce = d.setMinutes(me); // cas end

		// Obarvamo trenutno uro in uro, ki pride čez 15 minut.
		if((Date.now() >= cs && Date.now() <= ce) || ((Date.now() + 900000) >= cs && (Date.now() + 900000) <= ce)) {
			//vrste[i].getElementsByTagName("td")[d.getDay() % 6].style.backgroundColor = "#fff496";
			var napredek = (Date.now() - cs)/(ce - cs);
			console.log(napredek);
			//vrste[i].getElementsByTagName("td")[d.getDay() % 6].style.cssText = "border: 2px green solid; background: linear-gradient(#90ee90 "+(napredek*100)+"%, #fff496 "+(napredek*100)+"%)"; 
			vrste[i].getElementsByTagName("td")[d.getDay() % 6].style.cssText = "background: linear-gradient(#fffddd "+(napredek*100)+"%, #fff496 "+(napredek*100)+"%)"; 
		}
	}

	vrste[0].getElementsByTagName("td")[d.getDay() % 6].style.cssText = "border: 2px solid #ffa500; background-color: #ffedcc"; // Obarvamo dan na vrhu
}




